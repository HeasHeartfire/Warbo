<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<script
			  src="https://code.jquery.com/jquery-3.2.1.min.js"
			  integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
			  crossorigin="anonymous"></script>
	<script src="canvasengine-1.3.2.all.min.js"></script>
	<script src="Tiled.js"></script>
	<script src="Input.js"></script>
	<script src="socket.io.min.js"></script>
	<script>
	function getMousePos(canvas, evt) {
	    var rect = canvas.getBoundingClientRect();
	    return {
	      x: evt.clientX - rect.left,
	      y: evt.clientY - rect.top
	    };
	}

	CE.connectServer('http://127.0.0.1', 8333);
	var canvas = CE.defines("canvas_id").
	extend(Spritesheet).
	extend(Input).
	extend(Tiled).
	ready(function() {
		canvas.Scene.call("Scene_Map");
	});

	canvas.Scene.New({
		name: "Scene_Map",
		events: ["load"],
		materials: {
			images: {
				tileset: "tileset.png",
				player: "hero.png"
			}
		},
		ready: function(stage) {
			var player = this.createElement('player');
            var _canvas = this.getCanvas();
			var spritesheet = canvas.Spritesheet.new("player", {

				grid: [{
					size: [4, 4],
					tile: [32, 52],
					set: ["down", "down1", "down2", "down3"]
				}],
				btn_play: [433, 33, 215, 188]

			});
			spritesheet.draw(player, "down");
			stage.append(player);

            stage.on('click', function(e){
                var pos = _canvas.getMousePosition(e);
                console.log(pos);
            });
            
			
		},
		load: function(data) {

			var tiled = canvas.Tiled.New(),
				stage = this.getStage(),
				_canvas = this.getCanvas(),
				map = this.createElement();
            
			tiled.ready(function() {
				map.pack(this.getWidthPixel(), this.getHeightPixel());
			});

			tiled.load(this, map, data);

			stage.append(map);
		},
		render: function(stage) {
			stage.refresh();
		}

	});
	</script>
</head>

<body>
	<canvas id="canvas_id" width="675px" height="506px"></canvas>
</body>

</html>
